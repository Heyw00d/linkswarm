<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkSwarm Admin üêù</title>
    <meta name="robots" content="noindex, nofollow">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #0a0a0f; color: #fff; }
        .glow { box-shadow: 0 0 30px rgba(251, 191, 36, 0.2); }
        .card { background: #12121a; border: 1px solid #252533; border-radius: 12px; padding: 20px; }
        .honey { color: #fbbf24; }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body class="min-h-screen p-6">
    <!-- Auth Gate -->
    <div id="authGate" class="fixed inset-0 bg-[#0a0a0f] z-50 flex items-center justify-center">
        <div class="card glow max-w-sm w-full text-center">
            <div class="text-4xl mb-4">üêù</div>
            <h2 class="text-xl font-bold honey mb-2">Admin Access</h2>
            <form id="authForm" class="space-y-4">
                <input type="password" id="pwd" placeholder="Password" 
                    class="w-full px-4 py-3 bg-[#1a1a25] border border-[#252533] rounded-lg focus:border-[#fbbf24] outline-none">
                <button type="submit" class="w-full py-3 bg-[#fbbf24] text-black font-bold rounded-lg hover:bg-[#f59e0b]">
                    Enter
                </button>
                <p id="authError" class="text-red-400 text-sm hidden">Wrong password</p>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="hidden max-w-6xl mx-auto">
        <header class="flex items-center justify-between mb-8">
            <div class="flex items-center gap-3">
                <span class="text-3xl">üêù</span>
                <h1 class="text-2xl font-bold">LinkSwarm <span class="honey">Admin</span></h1>
            </div>
            <div class="flex items-center gap-2 text-sm text-gray-400">
                <span class="w-2 h-2 bg-green-400 rounded-full pulse"></span>
                <span id="lastUpdate">Loading...</span>
            </div>
        </header>

        <!-- Stats -->
        <div class="grid grid-cols-3 gap-4 mb-8">
            <div class="card">
                <div class="text-sm text-gray-400 mb-1">Waitlist</div>
                <div class="text-3xl font-bold honey" id="statWaitlist">-</div>
            </div>
            <div class="card">
                <div class="text-sm text-gray-400 mb-1">Sites</div>
                <div class="text-3xl font-bold" id="statSites">-</div>
            </div>
            <div class="card">
                <div class="text-sm text-gray-400 mb-1">Exchanges</div>
                <div class="text-3xl font-bold" id="statExchanges">-</div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-6">
            <!-- Recent Signups -->
            <div class="card">
                <h2 class="text-lg font-semibold mb-4">üìß Recent Signups</h2>
                <div id="signups" class="space-y-3">
                    <div class="text-gray-500">Loading...</div>
                </div>
            </div>

            <!-- Registry -->
            <div class="card">
                <h2 class="text-lg font-semibold mb-4">üåê Registry</h2>
                <div id="registry" class="space-y-3">
                    <div class="text-gray-500">Loading...</div>
                </div>
            </div>
        </div>

        <!-- All Waitlist -->
        <div class="card mt-6">
            <h2 class="text-lg font-semibold mb-4">üìã Full Waitlist</h2>
            <div id="fullWaitlist" class="space-y-2 max-h-64 overflow-y-auto">
                <div class="text-gray-500">Loading...</div>
            </div>
        </div>
    </div>

    <script>
        const API = 'https://strengths-count-thats-bidding.trycloudflare.com';
        let token = '';

        document.getElementById('authForm').onsubmit = async (e) => {
            e.preventDefault();
            token = document.getElementById('pwd').value;
            
            try {
                const res = await fetch(`${API}/stats`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (res.ok) {
                    sessionStorage.setItem('linkswarm_token', token);
                    document.getElementById('authGate').classList.add('hidden');
                    document.getElementById('dashboard').classList.remove('hidden');
                    loadData();
                } else {
                    document.getElementById('authError').classList.remove('hidden');
                }
            } catch (e) {
                document.getElementById('authError').textContent = 'Connection error';
                document.getElementById('authError').classList.remove('hidden');
            }
        };

        async function loadData() {
            try {
                // Stats
                const statsRes = await fetch(`${API}/stats`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const stats = await statsRes.json();
                
                document.getElementById('statWaitlist').textContent = stats.waitlist;
                document.getElementById('statSites').textContent = stats.sites;
                document.getElementById('statExchanges').textContent = stats.exchanges;
                
                // Recent signups
                if (stats.recentSignups && stats.recentSignups.length > 0) {
                    document.getElementById('signups').innerHTML = stats.recentSignups.map(s => `
                        <div class="flex justify-between items-center py-2 border-b border-[#252533]">
                            <span class="font-mono text-sm">${s.email}</span>
                            <span class="text-xs text-gray-500">${new Date(s.created_at).toLocaleDateString()}</span>
                        </div>
                    `).join('');
                } else {
                    document.getElementById('signups').innerHTML = '<div class="text-gray-500">No signups yet</div>';
                }

                // Registry
                const regRes = await fetch(`${API}/registry`);
                const reg = await regRes.json();
                
                document.getElementById('registry').innerHTML = reg.sites.map(s => `
                    <div class="flex justify-between items-center py-2 border-b border-[#252533]">
                        <div>
                            <span class="font-semibold">${s.name}</span>
                            <span class="text-xs text-gray-500 ml-2">${s.domain}</span>
                        </div>
                        <span class="text-xs ${s.verified ? 'text-green-400' : 'text-gray-500'}">${s.verified ? '‚úì Verified' : 'Pending'}</span>
                    </div>
                `).join('');

                // Full waitlist
                const wlRes = await fetch(`${API}/waitlist`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const wl = await wlRes.json();
                
                if (wl.signups && wl.signups.length > 0) {
                    document.getElementById('fullWaitlist').innerHTML = wl.signups.map(s => `
                        <div class="flex justify-between items-center py-1 text-sm">
                            <span class="font-mono">${s.email}</span>
                            <span class="text-xs text-gray-500">${s.source} ‚Ä¢ ${new Date(s.created_at).toLocaleString()}</span>
                        </div>
                    `).join('');
                } else {
                    document.getElementById('fullWaitlist').innerHTML = '<div class="text-gray-500">No signups yet</div>';
                }

                document.getElementById('lastUpdate').textContent = 'Updated ' + new Date().toLocaleTimeString();
                
            } catch (e) {
                console.error('Load error:', e);
            }
        }

        // Check for stored token
        const stored = sessionStorage.getItem('linkswarm_token');
        if (stored) {
            token = stored;
            fetch(`${API}/stats`, { headers: { 'Authorization': `Bearer ${token}` } })
                .then(r => {
                    if (r.ok) {
                        document.getElementById('authGate').classList.add('hidden');
                        document.getElementById('dashboard').classList.remove('hidden');
                        loadData();
                    }
                });
        }

        // Auto-refresh every 30s
        setInterval(() => {
            if (token) loadData();
        }, 30000);
    </script>
</body>
</html>
