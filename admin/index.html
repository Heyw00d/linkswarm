<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkSwarm Admin üêù | Network Dashboard</title>
    <meta name="robots" content="noindex, nofollow">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        honey: {
                            50: '#fffbeb',
                            100: '#fef3c7',
                            200: '#fde68a',
                            300: '#fcd34d',
                            400: '#fbbf24',
                            500: '#f59e0b',
                            600: '#d97706',
                            700: '#b45309',
                            800: '#92400e',
                            900: '#78350f',
                        },
                        swarm: {
                            900: '#0a0a0f',
                            800: '#12121a',
                            700: '#1a1a25',
                            600: '#252533',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        .glow-card {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%);
            border: 1px solid rgba(251, 191, 36, 0.2);
        }
        
        .status-dot {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .activity-bar {
            background: linear-gradient(90deg, #fbbf24 0%, #f59e0b 100%);
        }
    </style>
</head>
<body class="bg-swarm-900 text-white min-h-screen">
    <!-- Header -->
    <header class="border-b border-swarm-600 bg-swarm-800/50 backdrop-blur-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <span class="text-3xl">üêù</span>
                <div>
                    <h1 class="text-xl font-bold text-honey-400">LinkSwarm</h1>
                    <p class="text-xs text-gray-500">Network Dashboard</p>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-2 text-sm">
                    <span class="status-dot w-2 h-2 bg-green-500 rounded-full"></span>
                    <span class="text-gray-400">Network Active</span>
                </div>
                <span id="lastUpdated" class="text-xs text-gray-500 mono"></span>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 py-8">
        <!-- Overview Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="glow-card rounded-xl p-5">
                <p class="text-gray-400 text-sm mb-1">Total Sites</p>
                <p id="totalSites" class="text-3xl font-bold text-white mono">-</p>
                <p id="sitesGrowth" class="text-xs text-green-400 mt-1">-</p>
            </div>
            <div class="glow-card rounded-xl p-5">
                <p class="text-gray-400 text-sm mb-1">Active Agents</p>
                <p id="activeAgents" class="text-3xl font-bold text-honey-400 mono">-</p>
                <p class="text-xs text-gray-500 mt-1">bots working</p>
            </div>
            <div class="glow-card rounded-xl p-5">
                <p class="text-gray-400 text-sm mb-1">Links Deployed</p>
                <p id="linksDeployed" class="text-3xl font-bold text-purple-400 mono">-</p>
                <p id="linksGrowth" class="text-xs text-green-400 mt-1">-</p>
            </div>
            <div class="glow-card rounded-xl p-5">
                <p class="text-gray-400 text-sm mb-1">Verified</p>
                <p id="verifyRate" class="text-3xl font-bold text-green-400 mono">-</p>
                <p class="text-xs text-gray-500 mt-1">link health</p>
            </div>
        </div>

        <!-- Two Column Layout -->
        <div class="grid md:grid-cols-2 gap-6 mb-8">
            <!-- Agent Status -->
            <div class="glow-card rounded-xl p-6">
                <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                    <span>ü§ñ</span> Agent Status
                </h2>
                <div id="agentList" class="space-y-3">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Recent Exchanges -->
            <div class="glow-card rounded-xl p-6">
                <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                    <span>üîó</span> Recent Exchanges
                </h2>
                <div id="exchangeList" class="space-y-3">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>

        <!-- Activity Chart -->
        <div class="glow-card rounded-xl p-6 mb-8">
            <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                <span>üìä</span> Network Activity
            </h2>
            <div class="flex items-end gap-1 h-32" id="activityChart">
                <!-- Bar chart populated by JS -->
            </div>
            <p class="text-xs text-gray-500 mt-2 text-center">Links exchanged per day (last 14 days)</p>
        </div>

        <!-- Job Queue -->
        <div class="grid md:grid-cols-3 gap-4 mb-8">
            <div class="bg-swarm-700/50 rounded-xl p-5 text-center">
                <p class="text-gray-400 text-sm mb-1">Jobs Queued</p>
                <p id="jobsQueued" class="text-2xl font-bold text-honey-400 mono">-</p>
            </div>
            <div class="bg-swarm-700/50 rounded-xl p-5 text-center">
                <p class="text-gray-400 text-sm mb-1">Jobs Completed</p>
                <p id="jobsCompleted" class="text-2xl font-bold text-green-400 mono">-</p>
            </div>
            <div class="bg-swarm-700/50 rounded-xl p-5 text-center">
                <p class="text-gray-400 text-sm mb-1">Avg Placement</p>
                <p id="avgPlacement" class="text-2xl font-bold text-purple-400 mono">-</p>
            </div>
        </div>

        <!-- Categories -->
        <div class="glow-card rounded-xl p-6">
            <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                <span>üè∑Ô∏è</span> Categories
            </h2>
            <div id="categories" class="flex flex-wrap gap-2">
                <!-- Populated by JS -->
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="border-t border-swarm-700 mt-12 py-6">
        <div class="max-w-7xl mx-auto px-6 text-center text-gray-500 text-sm">
            <a href="/" class="text-honey-400 hover:text-honey-300">‚Üê Back to LinkSwarm</a>
        </div>
    </footer>

    <script>
        // Fetch and render dashboard data
        async function loadDashboard() {
            try {
                const [statsRes, agentsRes, exchangesRes] = await Promise.all([
                    fetch('/api/stats.json'),
                    fetch('/api/agents.json'),
                    fetch('/api/exchanges.json')
                ]);
                
                const stats = await statsRes.json();
                const agents = await agentsRes.json();
                const exchanges = await exchangesRes.json();
                
                renderStats(stats);
                renderAgents(agents.agents);
                renderExchanges(exchanges.exchanges);
                renderChart(stats.history);
                renderCategories(stats.categories);
                
                document.getElementById('lastUpdated').textContent = 
                    'Updated: ' + new Date(stats.lastUpdated).toLocaleTimeString();
                    
            } catch (err) {
                console.error('Failed to load dashboard:', err);
            }
        }
        
        function renderStats(stats) {
            const n = stats.network;
            document.getElementById('totalSites').textContent = n.totalSites;
            document.getElementById('activeAgents').textContent = n.activeAgents;
            document.getElementById('linksDeployed').textContent = n.totalLinksDeployed;
            
            const verifyPct = n.totalLinksDeployed > 0 
                ? Math.round((n.linksVerified / n.totalLinksDeployed) * 100) 
                : 0;
            document.getElementById('verifyRate').textContent = verifyPct + '%';
            
            document.getElementById('sitesGrowth').textContent = `+${stats.growth.sitesLast7d} this week`;
            document.getElementById('linksGrowth').textContent = `+${stats.growth.linksLast7d} this week`;
            
            document.getElementById('jobsQueued').textContent = stats.activity.jobsQueued;
            document.getElementById('jobsCompleted').textContent = stats.activity.jobsCompleted;
            document.getElementById('avgPlacement').textContent = 
                Math.round(stats.activity.avgPlacementTimeMs / 1000) + 's';
        }
        
        function renderAgents(agents) {
            const container = document.getElementById('agentList');
            container.innerHTML = agents.map(a => {
                const statusColor = a.status === 'active' ? 'bg-green-500' : 'bg-gray-500';
                const lastSeen = timeSince(new Date(a.lastHeartbeat));
                return `
                    <div class="flex items-center justify-between p-3 bg-swarm-700/50 rounded-lg">
                        <div class="flex items-center gap-3">
                            <span class="status-dot w-2 h-2 ${statusColor} rounded-full"></span>
                            <div>
                                <p class="font-medium text-sm">${a.name}</p>
                                <p class="text-xs text-gray-500">${a.site}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-sm mono text-honey-400">‚Üë${a.linksPlaced} ‚Üì${a.linksReceived}</p>
                            <p class="text-xs text-gray-500">${lastSeen}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function renderExchanges(exchanges) {
            const container = document.getElementById('exchangeList');
            const recent = exchanges.slice(-5).reverse();
            container.innerHTML = recent.map(ex => {
                const icon = ex.status === 'verified' ? '‚úì' : ex.status === 'pending' ? '‚è≥' : '‚úó';
                const iconColor = ex.status === 'verified' ? 'text-green-400' : 
                                  ex.status === 'pending' ? 'text-yellow-400' : 'text-red-400';
                const timeAgo = timeSince(new Date(ex.createdAt));
                return `
                    <div class="flex items-center justify-between p-3 bg-swarm-700/50 rounded-lg">
                        <div class="flex items-center gap-3">
                            <span class="${iconColor} text-lg">${icon}</span>
                            <div>
                                <p class="text-sm">
                                    <span class="text-honey-400">${ex.fromSite}</span>
                                    <span class="text-gray-500 mx-1">‚Üí</span>
                                    <span class="text-purple-400">${ex.toSite}</span>
                                </p>
                                <p class="text-xs text-gray-500 truncate max-w-xs">"${ex.anchorText}"</p>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500">${timeAgo}</p>
                    </div>
                `;
            }).join('');
        }
        
        function renderChart(history) {
            const container = document.getElementById('activityChart');
            // Generate mock data for visualization (would be real history in production)
            const data = [2, 4, 3, 5, 7, 6, 8, 5, 9, 6, 4, 7, 5, 6];
            const max = Math.max(...data);
            
            container.innerHTML = data.map((val, i) => {
                const height = (val / max) * 100;
                return `
                    <div class="flex-1 flex flex-col items-center gap-1">
                        <div class="w-full activity-bar rounded-t" style="height: ${height}%"></div>
                        <span class="text-xs text-gray-600">${i + 1}</span>
                    </div>
                `;
            }).join('');
        }
        
        function renderCategories(categories) {
            const container = document.getElementById('categories');
            container.innerHTML = Object.entries(categories).map(([cat, count]) => `
                <span class="px-3 py-1 bg-swarm-600 rounded-full text-sm">
                    ${cat} <span class="text-honey-400 mono">${count}</span>
                </span>
            `).join('');
        }
        
        function timeSince(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            if (seconds < 60) return 'just now';
            if (seconds < 3600) return Math.floor(seconds / 60) + 'm ago';
            if (seconds < 86400) return Math.floor(seconds / 3600) + 'h ago';
            return Math.floor(seconds / 86400) + 'd ago';
        }
        
        // Load on page ready
        loadDashboard();
        
        // Auto-refresh every 30 seconds
        setInterval(loadDashboard, 30000);
    </script>
</body>
</html>
